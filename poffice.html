<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Multi-step Registration Form</title>
    <style>
      /* Previous CSS styles remain the same */
      /* * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
        font-family: Arial, sans-serif;
      }

      body {
        background-color: #f0f2f5;
        display: flex;
        justify-content: center;
        align-items: center;
        min-height: 100vh;
        padding: 20px;
      } */

      .container {
        background: white;
        border-radius: 10px;
        box-shadow: 0 0 20px rgba(0, 0, 0, 0.1);
        width: 100%;
        max-width: 600px;
        padding: 30px;
      }

      .stepper {
        display: flex;
        justify-content: space-between;
        margin-bottom: 30px;
        position: relative;
      }

      .step {
        width: 30px;
        height: 30px;
        border-radius: 50%;
        background-color: #e0e0e0;
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        position: relative;
        z-index: 1;
      }

      .step.active {
        background-color: #4caf50;
      }

      .step.completed {
        background-color: #45a049;
      }

      .step-connector {
        position: absolute;
        top: 14px;
        left: 0;
        right: 0;
        height: 2px;
        background-color: #e0e0e0;
        z-index: 0;
      }

      .form-step {
        display: none;
      }

      .form-step.active {
        display: block;
      }

      .form-group {
        margin-bottom: 20px;
      }

      label {
        display: block;
        margin-bottom: 5px;
        color: #333;
        font-weight: bold;
      }

      input,
      select {
        width: 100%;
        padding: 10px;
        border: 1px solid #ddd;
        border-radius: 5px;
        font-size: 16px;
      }

      input:focus,
      select:focus {
        outline: none;
        border-color: #4caf50;
      }

      .birthday-inputs {
        display: flex;
        gap: 10px;
      }

      .birthday-inputs select,
      .birthday-inputs input {
        flex: 1;
      }

      .buttons {
        display: flex;
        justify-content: space-between;
        margin-top: 30px;
      }

      button {
        padding: 10px 20px;
        border: none;
        border-radius: 5px;
        font-size: 16px;
        cursor: pointer;
        transition: background-color 0.3s;
      }

      button:disabled {
        background-color: #cccccc;
        cursor: not-allowed;
      }

      .btn-next {
        background-color: #4caf50;
        color: white;
      }

      .btn-prev {
        background-color: #666;
        color: white;
      }

      .error {
        color: red;
        font-size: 14px;
        margin-top: 5px;
        display: none;
      }

      .loading {
        display: none;
        text-align: center;
        margin-top: 10px;
        color: #666;
      }

      .room-card.selected {
        border: 2px solid #4caf50; /* Highlight with green border */
        background-color: #e7f5e7; /* Light background for selected room */
      }

      .success-message {
        color: #4caf50;
        text-align: center;
        margin-top: 10px;
        display: none;
      }
      .room-cards {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 20px;
        margin-top: 20px;
      }

      .room-card {
        background: #f9f9f9;
        border-radius: 10px;
        padding: 15px;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        text-align: center;
      }

      .room-card h3 {
        margin-bottom: 10px;
      }

      .room-card p {
        margin-bottom: 10px;
        font-size: 14px;
        color: #555;
      }

      .radio-group {
        display: flex;
        gap: 20px;
        margin: 10px 0;
      }

      .radio-option {
        display: flex;
        align-items: center;
        gap: 5px;
      }

      .radio-option input[type="radio"] {
        width: auto;
      }

      textarea {
        width: 100%;
        padding: 10px;
        border: 1px solid #ddd;
        border-radius: 5px;
        font-size: 16px;
        min-height: 100px;
        resize: vertical;
      }

      textarea:focus {
        outline: none;
        border-color: #4caf50;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="stepper">
        <div class="step-connector"></div>
        <div class="step active">1</div>
        <div class="step">2</div>
        <div class="step">3</div>
      </div>

      <form id="multiStepForm">
        <!-- Step 1: User Registration -->
        <div class="form-step active" id="step1">
          <div class="form-group">
            <label for="name">First Name</label>
            <input type="text" id="name" name="name" required />
            <div class="error" id="nameError">Please enter your first name</div>
          </div>
          <div class="form-group">
            <label for="lastName">Last Name</label>
            <input type="text" id="lastName" name="lastName" required />
            <div class="error" id="lastNameError">
              Please enter your last name
            </div>
          </div>
          <div class="form-group">
            <label for="email">Email</label>
            <input type="email" id="email" name="email" required />
            <div class="error" id="emailError">Please enter a valid email</div>
          </div>
          <div class="form-group">
            <label for="birthday">Birthday</label>
            <div class="birthday-inputs">
              <select id="month" required>
                <option value="">Month</option>
                <option value="01">Jan</option>
                <option value="02">Feb</option>
                <option value="03">Mar</option>
                <option value="04">Apr</option>
                <option value="05">May</option>
                <option value="06">Jun</option>
                <option value="07">Jul</option>
                <option value="08">Aug</option>
                <option value="09">Sep</option>
                <option value="10">Oct</option>
                <option value="11">Nov</option>
                <option value="12">Dec</option>
              </select>
              <input
                type="number"
                id="day"
                placeholder="Day"
                min="1"
                max="31"
                required
              />
              <input
                type="number"
                id="year"
                placeholder="Year"
                min="1900"
                max="2024"
                required
              />
            </div>
            <div class="error" id="birthdayError">
              Please enter a valid birthday
            </div>
          </div>
          <div class="form-group">
            <label for="address">Address</label>
            <input type="text" id="address" name="address" required />
            <div class="error" id="addressError">Please enter your address</div>
          </div>
          <div class="form-group">
            <label for="state">State</label>
            <input type="text" id="state" name="state" required />
            <div class="error" id="stateError">Please enter your state</div>
          </div>
          <div class="form-group">
            <label for="city">City</label>
            <input type="text" id="city" name="city" required />
            <div class="error" id="cityError">Please enter your city</div>
          </div>
          <div class="form-group">
            <label for="country">Country</label>
            <input type="text" id="country" name="country" required />
            <div class="error" id="countryError">Please enter your country</div>
          </div>
          <div class="form-group">
            <label for="code">Postal Code</label>
            <input type="text" id="code" name="code" required />
            <div class="error" id="codeError">
              Please enter your postal code
            </div>
          </div>
          <div class="loading" id="step1Loading">Submitting...</div>
          <div class="success-message" id="step1Success">
            Information saved successfully!
          </div>
          <div class="buttons">
            <div></div>
            <button type="button" class="btn-next" onclick="submitStep1()">
              Next
            </button>
          </div>
        </div>

        <!-- Step 2: Date Selection -->
        <div class="form-step" id="step2">
          <h2>Step 2: Select Dates</h2>
          <div class="form-group">
            <label for="fromDate">From Date</label>
            <input
              type="text"
              id="fromDate"
              placeholder="DD-MMM-YYYY"
              required
            />
          </div>
          <div class="form-group">
            <label for="toDate">To Date</label>
            <input type="text" id="toDate" placeholder="DD-MMM-YYYY" required />
          </div>

          <div class="loading" id="loading">Loading available rooms...</div>
          <div class="error-message" id="errorMessage">
            No rooms available for the selected dates.
          </div>
          <button type="button" class="btn-next" onclick="fetchRooms()">
            Search for offices
          </button>

          <div class="room-cards" id="roomCards"></div>

          <div class="buttons">
            <button type="button" class="btn-prev" onclick="prevStep(2)">
              Previous
            </button>
            <button type="button" class="btn-next" onclick="nextStep(2)">
              Next
            </button>
          </div>
        </div>

          <!-- Updated Step 3 -->
      <div class="form-step" id="step3">
        <h2>Final Details</h2>
        
        <div class="form-group">
          <label>Flexible with Dates?</label>
          <div class="radio-group">
            <div class="radio-option">
              <input type="radio" id="flexibleYes" name="flexible" value="yes" required>
              <label for="flexibleYes">Yes</label>
            </div>
            <div class="radio-option">
              <input type="radio" id="flexibleNo" name="flexible" value="no" required>
              <label for="flexibleNo">No</label>
            </div>
          </div>
          <div class="error" id="flexibleError">Please select an option</div>
        </div>

        <div class="form-group">
          <label for="description">Additional Notes or Requirements</label>
          <textarea 
            id="description" 
            name="description" 
            placeholder="Please provide any additional details or special requirements..."
            required
          ></textarea>
          <div class="error" id="descriptionError">Please provide a description</div>
        </div>

        <div class="loading" id="step3Loading">Submitting your request...</div>
        <div class="success-message" id="step3Success">Booking request submitted successfully!</div>

        <div class="buttons">
          <button type="button" class="btn-prev" onclick="prevStep(3)">Previous</button>
          <button type="button" class="btn-next" onclick="finalSubmit()">Submit Request</button>
        </div>
      </div>
    </div>
      </form>
    </div>

    <script>
      let currentStep = 1;
      let userData = {};
      let userId = "";
      let selectedRoomId = "";

      function validateStep1() {
        const inputs = document.querySelectorAll(
          "#step1 input[required], #step1 select[required]"
        );
        let isValid = true;

        inputs.forEach((input) => {
          const error =
            input.id === "month" || input.id === "day" || input.id === "year"
              ? document.getElementById("birthdayError")
              : document.getElementById(`${input.id}Error`);

          if (!input.value.trim()) {
            error.style.display = "block";
            isValid = false;
          } else {
            error.style.display = "none";
            if (input.type === "email") {
              const emailPattern = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
              if (!emailPattern.test(input.value)) {
                error.style.display = "block";
                isValid = false;
              }
            }
          }
        });

        // Validate birthday
        const month = document.getElementById("month").value;
        const day = document.getElementById("day").value;
        const year = document.getElementById("year").value;

        if (!month || !day || !year) {
          document.getElementById("birthdayError").style.display = "block";
          isValid = false;
        }

        return isValid;
      }

      async function submitStep1() {
        if (!validateStep1()) return;

        const loading = document.getElementById("step1Loading");
        const success = document.getElementById("step1Success");
        loading.style.display = "block";

        // Format birthday to 'DD-MMM-YYYY'
        const month = document.getElementById("month").value;
        const day = document.getElementById("day").value.padStart(2, "0");
        const year = document.getElementById("year").value;
        const months = [
          "Jan",
          "Feb",
          "Mar",
          "Apr",
          "May",
          "Jun",
          "Jul",
          "Aug",
          "Sep",
          "Oct",
          "Nov",
          "Dec",
        ];
        const monthName = months[parseInt(month) - 1];
        const formattedBirthday = `${day}-${monthName}-${year}`;

        const formData = {
          name: document.getElementById("name").value,
          lastName: document.getElementById("lastName").value,
          email: document.getElementById("email").value,
          birthday: formattedBirthday,
          address: document.getElementById("address").value,
          state: document.getElementById("state").value,
          city: document.getElementById("city").value,
          country: document.getElementById("country").value,
          code: document.getElementById("code").value,
        };

        try {
          const response = await fetch(
            "https://8ey3ox6oxi.execute-api.eu-central-1.amazonaws.com/prod/rooms/user",
            {
              method: "POST",
              headers: {
                "Content-Type": "application/json",
              },
              body: JSON.stringify(formData),
            }
          );

          if (response.ok) {
            userData = { ...userData, ...formData };
            const responsedata = await response.json();
            console.log(responsedata);
            userId = responsedata.data.ID;
            console.log(response.body);
            success.style.display = "block";
            setTimeout(() => {
              nextStep(1);
              success.style.display = "none";
            }, 1000);
          } else {
            throw new Error("Submission failed");
          }
        } catch (error) {
          alert("Error submitting form. Please try again.");
          console.error("Error:", error);
        } finally {
          loading.style.display = "none";
        }
      }

      function formatDate(date) {
        const [day, month, year] = date.split("-");
        return `${day.padStart(2, "0")}-${month}-${year}`;
      }
      async function fetchRooms() {
        const fromDate = document.getElementById("fromDate").value;
        const toDate = document.getElementById("toDate").value;

        if (!fromDate || !toDate) {
          alert("Please select both dates.");
          return;
        }

        const formattedFromDate = formatDate(fromDate);
        const formattedToDate = formatDate(toDate);

        const loading = document.getElementById("loading");
        const errorMessage = document.getElementById("errorMessage");
        const roomCards = document.getElementById("roomCards");
        loading.style.display = "block";
        errorMessage.style.display = "none";
        roomCards.innerHTML = "";

        try {
          const response = await fetch(
            `https://8ey3ox6oxi.execute-api.eu-central-1.amazonaws.com/prod/rooms/available?from=${formattedFromDate}&to=${formattedToDate}`
          );
          const data = await response.json();

          if (data.length === 0) {
            errorMessage.style.display = "block";
          } else {
            data.availableRooms.forEach((room) => {
              const card = document.createElement("div");
              card.classList.add("room-card");

              card.innerHTML = `
          <h3>${room.Office_Name}</h3>
          <p><strong>Size:</strong> ${room.Size}</p>
          <p><strong>Location:</strong> ${room.Location.zc_display_value}</p>
          <p><strong>Seats:</strong> ${room.Number_of_Seats}</p>
          <p><strong>Facilities:</strong> ${room.Additional_Facilities.join(
            ", "
          )}</p>
        `;

              // Add click event listener to the room card
              card.addEventListener("click", () => {
                // Store the selected room's ID
                selectedRoomId = room.ID; // Assuming "Room_Id" is the ID field from the response
                console.log("Selected Room ID:", selectedRoomId); // This will log the ID of the clicked room

                // Optionally highlight the selected card or do other UI updates
                document
                  .querySelectorAll(".room-card")
                  .forEach((el) => el.classList.remove("selected"));
                card.classList.add("selected");
              });

              roomCards.appendChild(card);
            });
          }
        } catch (error) {
          console.error("Error fetching rooms:", error);
          alert("There was an error fetching rooms. Please try again.");
        } finally {
          loading.style.display = "none";
        }
      }

      function nextStep(step) {
    // Make sure you are correctly targeting the correct step
    const currentStepElement = document.getElementById(`step${step}`);
    const nextStepElement = document.getElementById(`step${step + 1}`);
    const steps = document.querySelectorAll(".step");

    // Hide current step
    currentStepElement.classList.remove("active");

    // Show next step
    nextStepElement.classList.add("active");

    // Update step indicators
    steps[step].classList.add("completed"); // Mark current step as completed
    steps[step + 1].classList.add("active"); // Mark next step as active

    // Increment current step index
    currentStep = step + 1;
}

      function prevStep(step) {
        document.getElementById(`step${step}`).classList.remove("active");
        document.getElementById(`step${step - 1}`).classList.add("active");
        document.querySelectorAll(".step")[step - 1].classList.remove("active");
        currentStep = step - 1;
      }

      function validateStep3() {
        let isValid = true;
        
        // Validate flexible option
        const flexible = document.querySelector('input[name="flexible"]:checked');
        if (!flexible) {
          document.getElementById('flexibleError').style.display = 'block';
          isValid = false;
        } else {
          document.getElementById('flexibleError').style.display = 'none';
        }

        // Validate description
        const description = document.getElementById('description').value.trim();
        if (!description) {
          document.getElementById('descriptionError').style.display = 'block';
          isValid = false;
        } else {
          document.getElementById('descriptionError').style.display = 'none';
        }

        return isValid;
      }

      async function finalSubmit() {
        if (!validateStep3()) return;

        const loading = document.getElementById('step3Loading');
        const success = document.getElementById('step3Success');
        loading.style.display = 'block';

        // Get values from previous steps and current step
        const fromDate = document.getElementById('fromDate').value;
        const toDate = document.getElementById('toDate').value;
        const flexible = document.querySelector('input[name="flexible"]:checked').value;
        const description = document.getElementById('description').value;

        const bookingData = {
          user: userId,
          from: formatDate(fromDate),
          to: formatDate(toDate),
          room: selectedRoomId,
          flexible: flexible,
          description: description
        };

        console.log('bookingData', bookingData);

        try {
          const response = await fetch('https://8ey3ox6oxi.execute-api.eu-central-1.amazonaws.com/prod/rooms', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json'
            },
            body: JSON.stringify(bookingData)
          });

          if (response.ok) {
            success.style.display = 'block';
            // Reset form or redirect user
            // setTimeout(() => {
            //   window.location.href = '/booking-confirmation'            }, 2000);
          } else {
            throw new Error('Submission failed');
          }
        } catch (error) {
          alert('Error submitting booking request. Please try again.');
          console.error('Error:', error);
        } finally {
          loading.style.display = 'none';
        }
      }

      // Initialize date pickers (assuming you're using a date picker library)
      document.addEventListener('DOMContentLoaded', function() {
        // Add any initialization code here
      });
    //   function finalSubmit() {
    //     alert("Final submission will be implemented later");
    //   }
    </script>
  </body>
</html>