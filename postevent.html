<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Create Your Event</title>
    <style>
      .form-container {
        max-width: 800px;
        margin: auto;
        background: #fff;
        padding: 20px 30px;
        border-radius: 8px;
      }

      h1 {
        text-align: center;
        color: #00838f;
        margin-bottom: 20px;
      }

      .section h2 {
        font-size: 18px;
        margin-bottom: 15px;
        color: #333;
      }

      .row {
        display: flex;
        gap: 20px;
        margin-bottom: 15px;
      }

      .form-group {
        flex: 1;
        display: flex;
        flex-direction: column;
      }

      label {
        margin-bottom: 8px;
        font-size: 14px;
        color: #666;
      }

      input,
      select,
      textarea {
        padding: 10px;
        border: 1px solid #ccc;
        border-radius: 4px;
        font-size: 14px;
      }

      textarea {
        resize: vertical;
        height: 80px;
      }

      .actions {
        display: flex;
        justify-content: space-between;
        margin-top: 20px;
      }

      button {
        padding: 10px 20px;
        font-size: 16px;
        border: none;
        border-radius: 4px;
        cursor: pointer;
      }

      button.cancel {
        background-color: #ccc;
        color: #333;
      }

      button.submit {
        background-color: #00838f;
        color: #fff;
      }

      button:hover {
        opacity: 0.9;
      }
    </style>
  </head>
  <body>
    <div class="form-container">
      <h1>Create your event</h1>
      <form id="eventForm" autocomplete="on">
        <!-- Personal Information -->
        <div class="section">
          <h2>Personal Information</h2>
          <div class="row">
            <div class="form-group">
              <label for="fullName">Full name</label>
              <input
                type="text"
                id="fullName"
                name="fullName"
                placeholder="e.g. John Doe"
                required
              />
            </div>
            <div class="form-group">
              <label for="companyName">Company name</label>
              <input
                type="text"
                id="companyName"
                name="companyName"
                placeholder="Company"
                required
              />
            </div>
          </div>
          <div class="row">
            <div class="form-group">
              <label for="email">Email</label>
              <input
                type="email"
                id="email"
                name="email"
                placeholder="example@example.com"
                required
              />
            </div>
            <div class="form-group">
              <label for="phoneNumber">Phone number</label>
              <input
                type="tel"
                id="phoneNumber"
                name="phoneNumber"
                placeholder="XXXXXXXXXX"
                required
              />
            </div>
          </div>
        </div>

        <!-- Event Details -->
        <div class="section">
          <h2>Event Details</h2>
          <div class="row">
            <div class="form-group">
              <label for="eventTitle">Event title</label>
              <input
                type="text"
                id="eventTitle"
                name="eventTitle"
                placeholder="Event name"
                required
              />
            </div>
            <div class="form-group">
              <label for="eventType">Type of event</label>
              <select id="eventType" name="eventType" required>
                <option value="Public">Public</option>
                <option value="Private">Private</option>
              </select>
            </div>
          </div>
          <div class="row">
            <div class="form-group">
              <label for="startDate">Start date</label>
              <input type="date" id="startDate" name="startDate" required />
            </div>
            <div class="form-group">
              <label for="startTime">Time</label>
              <input type="time" id="startTime" name="startTime" required />
            </div>
          </div>
          <div class="row">
            <div class="form-group">
              <label for="endDate">End date</label>
              <input type="date" id="endDate" name="endDate" required />
            </div>
            <div class="form-group">
              <label for="endTime">Time</label>
              <input type="time" id="endTime" name="endTime" required />
            </div>
          </div>
          <div class="row">
            <div class="form-group">
              <label for="eventCategory">Type of event</label>
              <select id="eventCategory" name="eventCategory" required>
                <option value="corporate">Corporate gathering</option>
                <option value="social">Social event</option>
              </select>
            </div>
            <div class="form-group">
              <label for="space">Space</label>
              <select id="space" name="space" required>
                <option value="coworking">Coworking space</option>
                <option value="conference">Conference room</option>
              </select>
            </div>
          </div>
          <div class="row">
            <div class="form-group">
              <label for="members">Number of members</label>
              <input
                type="number"
                id="members"
                name="members"
                placeholder="0"
                required
              />
            </div>
            <div class="form-group">
              <label for="budget">Budget</label>
              <input
                type="number"
                id="budget"
                name="budget"
                placeholder="0"
                required
              />
            </div>
          </div>
        </div>

        <!-- Additional Information -->
        <div class="section">
          <div class="form-group">
            <label for="additionalResources">Additional resources</label>
            <textarea
              id="additionalResources"
              name="additionalResources"
              placeholder="Additional resources needed"
            ></textarea>
          </div>
          <div class="form-group">
            <label for="notes">Notes</label>
            <textarea
              id="notes"
              name="notes"
              placeholder="Add a note here"
            ></textarea>
          </div>
        </div>

        <!-- Buttons -->
        <div class="actions">
          <button type="reset" class="cancel">Cancel</button>
          <button type="button" class="submit" onclick="handleSubmit()">
            Submit request
          </button>
        </div>
      </form>
    </div>

    <script>
      async function handleSubmit() {
        let userId = "";
        const formData = {
          fullName: document.getElementById("fullName").value,
          companyName: document.getElementById("companyName").value,
          email: document.getElementById("email").value,
          phoneNumber: document.getElementById("phoneNumber").value,
          eventTitle: document.getElementById("eventTitle").value,
          eventType: document.getElementById("eventType").value,
          startDate: document.getElementById("startDate").value,
          startTime: document.getElementById("startTime").value,
          endDate: document.getElementById("endDate").value,
          endTime: document.getElementById("endTime").value,
          eventCategory: document.getElementById("eventCategory").value,
          space: document.getElementById("space").value,
          members: document.getElementById("members").value,
          budget: document.getElementById("budget").value,
          additionalResources: document.getElementById("additionalResources")
            .value,
          notes: document.getElementById("notes").value,
        };
        console.log("ðŸš€ ~ handleSubmit ~ formData.endTime:", formData.endTime);
        console.log("ðŸš€ ~ handleSubmit ~ formData.endDate:", formData.endDate);
        console.log(
          "ðŸš€ ~ handleSubmit ~ formData.startDate:",
          formData.startDate
        );
        console.log(
          "ðŸš€ ~ handleSubmit ~ formData.startTime:",
          formData.startTime
        );
        let [firstName, ...lastNameParts] = formData.fullName.trim().split(" ");
        const lastName = lastNameParts.join(" ");

        const userData = {
          name: firstName,
          lastName: lastName,
          email: formData.email,
          phone: formData.phoneNumber,
          company: formData.companyName,
          address: "Tirana",
          state: "Tirana",
          country: "Albania",
          code: "1001",
          referral: "Event Form",
        };
        console.log("ðŸš€ ~ handleSubmit ~ userData:", userData);

        try {
          const response = await fetch(
            "https://8ey3ox6oxi.execute-api.eu-central-1.amazonaws.com/prod/leads",
            {
              method: "POST",
              headers: {
                "Content-Type": "application/json",
              },
              body: JSON.stringify(userData),
            }
          );

          if (!response.ok) {
            throw new Error("Failed to create user");
          }

          const userResponse = await response.json();
          console.log("ðŸš€ ~ handleSubmit ~ userResponse:", userResponse);
          userId = userResponse.data.id;
          console.log("ðŸš€ ~ handleSubmit ~ userId:", userId);
        } catch (error) {
          console.error("Error creating user:", error);
          throw error;
        }

        const newEvent = {
          event: formData.eventTitle,
          user: userId,
          from: `${formData.startDate}T${formData.startTime}:00+02:00`,
          to: `${formData.endDate}T${formData.endTime}:00+02:00`,
          room: "761384000000570824",
          description: formData.notes,
        };

        try {
          const response = await fetch(
            "https://8ey3ox6oxi.execute-api.eu-central-1.amazonaws.com/prod/event",
            {
              method: "POST",
              headers: {
                "Content-Type": "application/json",
              },
              body: JSON.stringify(newEvent),
            }
          );

          if (!response.ok) {
            throw new Error("Failed to create user");
          }

          const putResponse = await response.json();
          console.log("ðŸš€ ~ handleSubmit ~ putResponse:", putResponse);
        } catch (error) {
          console.error("Error creating user:", error);
          throw error;
        }
      }
    </script>
  </body>
</html>
